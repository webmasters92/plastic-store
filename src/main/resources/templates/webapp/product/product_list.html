<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="webapp/containers/headContainer :: headContainer"></head>

<body>

<div th:replace="webapp/containers/headerContainer :: headerContainer" th:with="${categories}"></div>

<!--=============================================
=            breadcrumb area         =
=============================================-->

<div class="breadcrumb-area pt-15 pb-15">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!--=======  breadcrumb container  =======-->

                <div class="breadcrumb-container">
                    <nav>
                        <ul>
                            <li class="parent-page"><a th:href="@{/}">Početna</a></li>
                            <li id="breadcrumb" th:value="${selected_category.id}" th:text="${selected_category.name}"></li>
                        </ul>
                    </nav>
                </div>
                <!--=======  End of breadcrumb container  =======-->
            </div>
        </div>
    </div>
</div>

<!--=====  End of breadcrumb area  ======-->

<!--=============================================
=            shop page content         =
=============================================-->

<div class="shop-page-content mb-50">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 order-2 order-lg-1">
                <!--=======  page sidebar   =======-->

                <div class="page-sidebar">
                    <!--=======  single sidebar block  =======-->

                    <div class="single-sidebar">
                        <h3 class="sidebar-title">KATEGORIJE</h3>

                        <div class="category">
                            <ul>
                                <li th:each="category : ${categories}"><a th:value="${category.id}" th:text="${category.name}"></a></li>
                            </ul>
                        </div>
                    </div>

                    <!--=======  End of single sidebar block  =======-->

                    <!--=======  single sidebar block  =======-->

                    <div class="single-sidebar price-range-bg">
                        <h3 class="sidebar-title filter-price-title">FILTER PO CENI</h3>
                        <div class="sidebar-price">
                            <div id="price-range"></div>
                            <input type="text" id="price-amount" class="price-amount" readonly>
                        </div>
                    </div>

                    <!--=======  End of single sidebar block  =======-->

                    <!--=======  single sidebar block  =======-->

                    <div class="single-sidebar mb-30">
                        <h3 class="sidebar-title color-title">BOJE</h3>
                        <div class="color-category">
                            <ul>
                                <li><a href="shop-left-sidebar.html">Black</a> <span class="counter">(2)</span></li>
                                <li><a href="shop-left-sidebar.html">Blue</a> <span class="counter">(4)</span></li>
                                <li><a href="shop-left-sidebar.html">Red</a> <span class="counter">(1)</span></li>
                                <li><a href="shop-left-sidebar.html">Yellow</a> <span class="counter">(5)</span></li>
                            </ul>
                        </div>
                    </div>

                    <!--=======  End of single sidebar block  =======-->

                    <!--=======  single sidebar block  =======-->

                    <div class="single-sidebar">
                        <h3 class="sidebar-title">POPULARNI TAGOVI</h3>

                        <!--=======  tag container  =======-->

                        <ul class="tag-container">
                            <li><a href="shop-left-sidebar.html">new</a> </li>
                            <li><a href="shop-left-sidebar.html">bags</a> </li>
                            <li><a href="shop-left-sidebar.html">new</a> </li>
                            <li><a href="shop-left-sidebar.html">kids</a> </li>
                            <li><a href="shop-left-sidebar.html">fashion</a> </li>
                            <li><a href="shop-left-sidebar.html">Accessories</a> </li>
                        </ul>

                        <!--=======  End of tag container  =======-->
                    </div>

                    <!--=======  End of single sidebar block  =======-->
                </div>

                <!--=======  End of page sidebar   =======-->
            </div>

            <div class="col-lg-9 order-1 order-lg-2">

                <!--=======  Shop header  =======-->

                <div class="shop-header mb-30">
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-12 d-flex align-items-center">
                            <!--=======  view mode  =======-->

                            <div class="view-mode-icons mb-xs-10">
                                <a class="active" href="#" data-target="grid"><i class="icon ion-md-apps"></i></a>
                                <a href="#" data-target="list"><i class="icon ion-ios-list"></i></a>
                            </div>

                            <!--=======  End of view mode  =======-->

                        </div>
                        <div class="col-lg-8 col-md-8 col-sm-12 d-flex flex-column flex-sm-row justify-content-between align-items-left align-items-sm-center">
                            <!--=======  Sort by dropdown  =======-->

                            <div class="sort-by-dropdown d-flex align-items-center mb-xs-10">
                                <p class="mr-10 mb-0">Sortiraj: </p>
                                <select name="sort-by" id="sort-by" class="nice-select">
                                    <option value="min-price">Najjeftinije prvo</option>
                                    <option value="max-price">Najskuplje prvo</option>
                                    <option selected value="name-asc">Naziv A-Z</option>
                                    <option value="name-desc">Naziv Z-A</option>
                                    <!--                                    <option value="0">Ocena</option>-->
                                </select>
                            </div>

                            <!--=======  End of Sort by dropdown  =======-->

                            <p th:text="'Prikazano 1-12 od '+${pagination.getTotalElements()}" class="result-show-message"></p>
                        </div>
                    </div>
                </div>

                <!--=======  End of Shop header  =======-->

                <!--=======  shop products display area  =======-->
                <div class="shop-product-wrap grid row mb-30 no-gutters">
                    <div class="col-lg-3 col-md-6 col-sm-6 col-12" th:each="product : ${products}">
                        <!--=======  grid view product  =======-->

                        <div class="fl-product shop-grid-view-product">
                            <div class="image">
                                <a th:href="@{/product/single_product/__${product.id}__}">
                                    <img th:src="@{'/images/' + ${product.images.get(0).name}}" class="img-fluid" alt="">
                                    <img th:src="@{'/images/' + ${product.images.get(0).name}}" class="img-fluid" alt="">
                                </a>
                            </div>
                            <div class="content">
                                <h2 class="product-title"><a th:text="${product.getName()}" href="single-product.html">Officiis debitis</a></h2>
                                <div class="rating">
                                    <i class="fa fa-star active"></i>
                                    <i class="fa fa-star active"></i>
                                    <i class="fa fa-star active"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                </div>
                                <p class="product-price">
                                    <!--                                    <span   class="main-price discounted"></span>-->
                                    <span th:text="${product.productAttributes.get(0).price}+' RSD'" class="discounted-price"></span>
                                </p>

                                <div class="hover-icons">
                                    <ul>
                                        <li><a href="#" data-tooltip="Dodaj u korpu"><i class="icon ion-md-cart"></i></a></li>
                                        <li><a href="#" data-tooltip="Dodaj u listu želja"><i class="icon ion-md-heart-empty"></i></a></li>
                                        <li><a href="#" data-tooltip="Detaljnije" th:onclick="'javascript:openProductModal(\'' + ${product.id} + '\');'"><i class="icon ion-md-open"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!--=======  End of grid view product  =======-->

                        <!--=======  list view product  =======-->

                        <div class="fl-product shop-list-view-product">
                            <div class="image">
                                <a th:href="@{/product/single_product/__${product.id}__}">
                                    <img th:src="@{'/images/' + ${product.images.get(0).name}}" class="img-fluid" alt="">
                                    <img th:src="@{'/images/' + ${product.images.get(0).name}}" class="img-fluid" alt="">
                                </a>
                            </div>
                            <div class="content">
                                <h2 class="product-title"><a th:text="${product.name}" href="single-product.html">Officiis debitis</a></h2>
                                <div class="rating">
                                    <i class="fa fa-star active"></i>
                                    <i class="fa fa-star active"></i>
                                    <i class="fa fa-star active"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                </div>
                                <p class="product-price">
                                    <!--                                    <span   class="main-price discounted"></span>-->
                                    <span th:text="${product.productAttributes.get(0).price}+' RSD'" class="discounted-price"></span>
                                </p>

                                <p th:text="${product.description}" class="product-description"></p>

                                <div class="hover-icons">
                                    <ul>
                                        <li><a href="#" data-tooltip="Dodaj u korpu">Dodaj u korpu</a></li>
                                        <li><a href="#" data-tooltip="Dodaj u listu želja"><i class="icon ion-md-heart-empty"></i></a></li>
                                        <li><a href="#" data-tooltip="Detaljnije" data-toggle="modal" data-target="#quick-view-modal-container"><i class="icon ion-md-open"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!--=======  End of list view product  =======-->
                    </div>
                </div>

                <!--=======  End of shop products display area  =======-->

                <!--=======  pagination area  =======-->

                <div th:if="${pagination.getTotalPages() > 0}" class="pagination-area mb-md-50 mb-sm-50">
                    <ul>
                        <li th:each="pageNumber : ${#numbers.sequence(0, pagination.getTotalPages() - 1)}">
                            <a th:onclick="'javascript:loadPage(\''+ ${pageNumber} +'\');'" th:classappend="${pageNumber eq pagination.getNumber()} ? 'active'" th:text="${pageNumber}+1"></a></li>
                        <li th:classappend="${pagination.getNumber()+1 eq pagination.getTotalPages()} ? 'disabled'">
                            <a th:onclick="'javascript:loadPage(\''+ ${pagination.getNumber()+1} +'\');'">
                                <i class="fa fa-angle-double-right"></i></a></li>
                    </ul>
                </div>

                <!--=======  End of pagination area  =======-->
            </div>
        </div>
    </div>
</div>
<!--QUICK VIEW MODAL-->
<div class="modal fade quick-view-modal-container" id="quick-view-modal-container" tabindex="-1" role="dialog" aria-hidden="true"></div>
<!--=====  End of shop page content  ======-->

<!--FOOTER-->

<div th:replace="webapp/containers/footerContainer :: footerContainer"></div>

<div th:insert="webapp/containers/scriptsContainer :: scriptsContainer"></div>

<script th:inline="javascript" type="text/javascript">

    $(document).ready(function () {
        $('.modal').on('shown.bs.modal', function (e) {
            $('.small-image-slider').resize();
            addProductSlider();
        });

        $('.category > ul > li a').each(function () {
            if ($(this).attr('value') === $("#breadcrumb").attr('value')) {
                $(this).addClass('active');
            }
        });

        $('.category > ul > li a').on('click', function () {
            $('.category > ul > li a').removeClass();
            $(this).addClass('active');
            $("#price-range").slider('values', 0, 0);
            $("#price-range").slider('values', 1, 10000);
            $('#price-amount').val('Cena: ' + '$' + 0 + ' - $' + 10000);
            var min = $("#price-range").slider("option", "min");
            var max = $("#price-range").slider("option", "max");
            refreshBreadCrumb($(this).text());
            showProductList($(this).attr("value"), 0, min, max, "name-asc");
        });

        $('#sort-by').on('change', function () {
            var categoryId = $(".category > ul > li a.active").attr("value");
            var min = $("#price-range").slider("option", "min");
            var max = $("#price-range").slider("option", "max");
            showProductList(categoryId, 0, min, max, this.value);
        });

        $('#price-range').slider({
            change: function (event, ui) {
                var categoryId = $(".category > ul > li a.active").attr("value");
                showProductList(categoryId, 0, ui.values[0], ui.values[1], $('#sort-by').val());
            }
        })
    });

    function openProductModal(productID) {
        $.ajax({
            url: '/product/product_modal/' + productID,
            type: 'get',
            success: function (response) {
                $(".modal").html(response);
                $(".modal").modal('show');
            }
        });
    }

    function showProductList(categoryID, page, minPrice, maxPrice, sort) {
        $.ajax({
            url: '/product/product_list_category_fragment/' + categoryID + '/' + page + '/' + minPrice + '/' + maxPrice + '/' + sort,
            type: 'get',
            success: function (response) {
                $('.shop-product-wrap').html(response);
            }
        });
        refreshPagination(categoryID, page, minPrice, maxPrice, sort);
        refreshProductHeader(categoryID, page, minPrice, maxPrice);
    }

    function refreshBreadCrumb(name) {
        $("#breadcrumb").text(name);
    }

    function refreshPagination(categoryId, page, min, max, sort) {
        $.ajax({
            url: '/product/refresh_pagination/' + categoryId + '/' + page + '/' + min + '/' + max + '/' + sort,
            type: 'get',
            success: function (response) {
                $(".pagination-area").replaceWith(response);
            }
        });
    }

    function refreshProductHeader(categoryId, page, min, max) {
        $.ajax({
            url: '/product/refresh_product_header/' + categoryId + '/' + page + '/' + min + '/' + max,
            type: 'get',
            success: function (response) {
                $(".result-show-message").replaceWith(response);
                $("#sort-by option[value='name-asc']").attr("selected", true);            }
        });
    }

    function loadPage(page) {
        var id = $(".category> ul > li a.active").attr("value");
        var min = $("#price-range").slider("option", "min");
        var max = $("#price-range").slider("option", "max");
        var sort = $('#sort-by').val();
        showProductList(id, page, min, max, sort);
    }

    function addProductSlider() {
        $('.small-image-slider, .quickview-small-image-slider').slick({
            prevArrow: '<i class="fa fa-angle-left slick-prev"></i>',
            nextArrow: '<i class="fa fa-angle-right slick-next"></i>',
            arrows: true,
            dots: false,
            slidesToShow: 4,
            responsive: [
                {
                    breakpoint: 1499,
                    settings: {
                        slidesToShow: 4,
                    }
                },
                {
                    breakpoint: 1199,
                    settings: {
                        slidesToShow: 3,
                    }
                },
                {
                    breakpoint: 991,
                    settings: {
                        slidesToShow: 3,
                    }
                },
                {
                    breakpoint: 767,
                    settings: {
                        slidesToShow: 3,
                        arrows: false
                    }
                },
                {
                    breakpoint: 575,
                    settings: {
                        slidesToShow: 3,
                        arrows: false
                    }
                },
                {
                    breakpoint: 479,
                    settings: {
                        slidesToShow: 2,
                        arrows: false
                    }
                }
            ]
        });
    }

</script>
</body>
</html>