<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="webapp/containers/headContainer :: headContainer(title='Plastika Drašković - Obrada porudžbine')"></head>

<body>
<div th:replace="webapp/containers/headerContainer :: headerContainer" th:with="${categories}"></div>

<div class="breadcrumb-area pt-15 pb-15">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!--=======  breadcrumb container  =======-->

                <div class="breadcrumb-container">
                    <nav>
                        <ul>
                            <li class="parent-page"><a th:href="@{/}" th:text="#{home}">Početna</a></li>
                            <li th:text="#{order.processing}">Obrada porudžbine</li>
                        </ul>
                    </nav>
                </div>
                <!--=======  End of breadcrumb container  =======-->
            </div>
        </div>
    </div>
</div>

<div class="page-section mb-50">
    <div class="container">
        <div class="row">
            <div class="col-12">

                <!-- Checkout Form s-->
                <form class="checkout-form" id="checkout-form-validation" method="post"
                      th:action="@{/checkout/place_order}" th:object="${order}">
                    <div class="row row-40">

                        <div class="col-lg-7 mb-20">

                            <!-- Billing Address -->
                            <div class="mb-40" id="billing-form">
                                <h4 class="checkout-title" th:text="#{delivery}">ISPORUKA</h4>

                                <div class="row">

                                    <div class="col-md-6 col-12 mb-20">
                                        <label for="customer_first_name"
                                               th:if="${order.getCustomer()!=null}" th:text="#{first.name}">Ime*</label>
                                        <input id="customer_first_name" name="customer_first_name"
                                               required
                                               th:field="*{customer.firstName}" th:if="${order.getCustomer()!=null}"
                                               type="text">
                                        <label for="guest_first_name" th:if="${order.getCustomer()==null}"
                                               th:text="#{first.name}">Ime*</label>
                                        <input id="guest_first_name" name="guest_first_name"
                                               required
                                               th:field="*{guest.firstName}" th:if="${order.getCustomer()==null}"
                                               type="text">
                                    </div>

                                    <div class="col-md-6 col-12 mb-20">
                                        <label for="customer_last_name"
                                               th:if="${order.getCustomer()!=null}"
                                               th:text="#{last.name}">Prezime*</label>
                                        <input id="customer_last_name" name="customer_last_name"
                                               required
                                               th:field="*{customer.lastName}" th:if="${order.getCustomer()!=null}"
                                               type="text">
                                        <label for="guest_last_name"
                                               th:if="${order.getCustomer()==null}"
                                               th:text="#{last.name}">Prezime*</label>
                                        <input id="guest_last_name" name="guest_last_name"
                                               required
                                               th:field="*{guest.lastName}" th:if="${order.getCustomer()==null}"
                                               type="text">
                                    </div>

                                    <div class="col-md-6 col-12 mb-20">
                                        <label for="customer_email" th:if="${order.getCustomer()!=null}"
                                               th:text="#{email}">Email*</label>
                                        <input id="customer_email" name="customer_email"
                                               required
                                               th:field="*{customer.email}" th:if="${order.getCustomer()!=null}"
                                               type="email">
                                        <label for="guest_email" th:if="${order.getCustomer()==null}"
                                               th:text="#{email}">Email*</label>
                                        <input id="guest_email" name="guest_email"
                                               required
                                               th:field="*{guest.email}" th:if="${order.getCustomer()==null}"
                                               type="email">
                                    </div>

                                    <div class="col-md-6 col-12 mb-20">
                                        <label for="customer_phone_number"
                                               th:if="${order.getCustomer()!=null}"
                                               th:text="#{phone.number}">Telefon*</label>
                                        <input id="customer_phone_number" maxlength="15" name="customer_phone_number"
                                               required
                                               th:field="*{customer.phoneNumber}"
                                               th:if="${order.getCustomer()!=null}" type="number">
                                        <label for="guest_phone_number"
                                               th:if="${order.getCustomer()==null}"
                                               th:text="#{phone.number}">Telefon*</label>
                                        <input id="guest_phone_number" maxlength="15" name="guest_phone_number" required
                                               th:field="*{guest.phoneNumber}"
                                               th:if="${order.getCustomer()==null}" type="number">
                                    </div>

                                    <div class="col-12 mb-20">
                                        <label for="customer_address"
                                               th:if="${order.getCustomer()!=null}" th:text="#{address}">Adresa*</label>
                                        <input id="customer_address" name="customer_address"
                                               required
                                               th:field="*{customer.address}" th:if="${order.getCustomer()!=null}"
                                               type="text">
                                        <label for="guest_address" th:if="${order.getCustomer()==null}"
                                               th:text="#{address}">Adresa*</label>
                                        <input id="guest_address" name="guest_address"
                                               required
                                               th:field="*{guest.address}" th:if="${order.getCustomer()==null}"
                                               type="text">
                                    </div>

                                    <div class="col-md-6 col-12 mb-20">
                                        <label>Država*</label>
                                        <select class="nice-select" th:field="*{customer.country}"
                                                th:if="${order.getCustomer()!=null}">
                                            <option th:text="#{serbia}" value="Srbija">Srbija</option>
                                        </select>
                                        <select class="nice-select" th:field="*{guest.country}"
                                                th:if="${order.getCustomer()==null}">
                                            <option th:text="#{serbia}" value="Srbija">Srbija</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6 col-12 mb-20">
                                        <label for="customer_city" th:if="${order.getCustomer()!=null}"
                                               th:text="#{city}">Grad*</label>
                                        <input id="customer_city" name="customer_city"
                                               required
                                               th:field="*{customer.city}" th:if="${order.getCustomer()!=null}"
                                               type="text">
                                        <label for="guest_city" th:if="${order.getCustomer()==null}" th:text="#{city}">Grad*</label>
                                        <input id="guest_city" name="guest_city"
                                               required
                                               th:field="*{guest.city}" th:if="${order.getCustomer()==null}"
                                               type="text">
                                    </div>

                                    <div class="col-md-6 col-12 mb-20">
                                        <label for="customer_zip_code" th:if="${order.getCustomer()!=null}"
                                               th:text="#{zip.code}">Poštanski
                                            broj*</label>
                                        <input id="customer_zip_code" maxlength="5"
                                               name="customer_zip_code" required
                                               th:field="*{customer.zipCode}" th:if="${order.getCustomer()!=null}"
                                               type="number">
                                        <label for="guest_zip_code" th:if="${order.getCustomer()==null}"
                                               th:text="#{zip.code}">Poštanski
                                            broj*</label>
                                        <input id="guest_zip_code" maxlength="5"
                                               name="guest_zip_code" required
                                               th:field="*{guest.zipCode}" th:if="${order.getCustomer()==null}"
                                               type="number">

                                        <div class="col-12 mt-20">
                                            <div class="check-box">
                                                <input id="create_account" type="checkbox">
                                                <label for="create_account"><a th:href="@{/customer/register}"
                                                                               th:text="#{create.account}">Kreiraj
                                                    nalog?</a></label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 col-12 mb-20" style="display: grid">
                                        <label for="order_message" style="margin-bottom: 0px;" th:text="#{note}">Napomena</label>
                                        <textarea  id="order_message" maxlength="100" name="order_message" style="height: 100px; resize: none;" th:field="*{message}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-5">
                            <div class="row">

                                <!-- Cart Total -->
                                <div class="col-12 mb-60">

                                    <h4 class="checkout-title" th:text="#{shopping}">Kupovina</h4>

                                    <div class="checkout-cart-total">

                                        <h4 th:text="#{products}">Proizvodi <span th:text="#{total}">Ukupno</span></h4>

                                        <ul th:field="*{orderItems}">
                                            <li class="d-flex justify-content-between"
                                                th:each="item : ${order.getOrderItems()}">
                                                <div th:text="${item.getProduct().getName()}+'  x'+${item.getQuantity()}"></div>
                                                <div th:text="${item.getTotalPrice()}+' RSD'"></div>
                                            </li>
                                        </ul>

                                        <p th:text="#{total}">Ukupno <span
                                                th:text="${order.getOrderTotal()}+ ' RSD'"></span></p>
                                        <p th:text="#{delivery}">Dostava <span
                                                th:text="${order.getOrderTotal()>2000}?'Kurirska služba (Besplatna dostava)': 'Kurirska služba'"></span>
                                        </p>
                                        <h4 th:text="#{total.price}">Ukupan iznos za uplatu<span
                                                th:field="*{orderTotal}"
                                                th:text="${order.getOrderTotal()}+' RSD'"></span>
                                        </h4>
                                    </div>
                                </div>

                                <!-- Payment Method -->
                                <div class="col-12">
                                    <h4 class="checkout-title" th:text="#{payment.method}">Izaberite način plaćanja</h4>
                                    <div class="checkout-payment-method">
                                        <div class="singled-method">
                                            <input id="payment_cash" name="payment_cash" required type="checkbox"
                                                   value="cash">
                                            <label class="payment_method_label" for="payment_cash"
                                                   th:text="#{cash.on.delivery}">Plaćanje
                                                prilikom preuzimanja</label>
                                        </div>

                                        <div class="singsle-method">
                                            <input class="accept_terms" id="accept_terms" name="terms_box" required
                                                   type="checkbox">
                                            <label class="terms_label" for="accept_terms"><a
                                                    th:href="@{/selling_terms}" th:text="#{accept.terms}">Prihvatam
                                                uslove kupovine</a></label>
                                        </div>
                                    </div>
                                    <input name="${_csrf.parameterName}" type="hidden" value="${_csrf.token}"/>
                                    <button class="place-order" th:text="#{confirm.order}" type="submit">Potvrdi
                                        kupovinu
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div th:replace="webapp/containers/footerContainer :: footerContainer"></div>

<div class="search-overlay" id="search-overlay">
    <a class="search-overlay-close" href="#" id="search-overlay-close"><i class="fa fa-times"></i></a>
    <div class="search-box">
        <input placeholder="Search entire store here" type="search">
        <button><i class="icon ion-md-search"></i></button>
    </div>
</div>
<a class="scroll-top" href="#"></a>

<div th:insert="webapp/containers/scriptsContainer :: scriptsContainer"></div>

<script th:inline="javascript" type="text/javascript">
    var token = $('#_csrf').attr('content');
    var header = $('#_csrf_header').attr('content');

    $(document).ready(function () {
        $('.loader').attr('data-after', 'Vaša porudžbina se obrađuje, molimo sačekajte...');
        $("#checkout-form-validation").submit(function (e) {
            $('.loader-wrap').show();
            e.preventDefault();

            var form = $(this);
            var url = form.attr('action');
            if (!form.valid()) return false;
            $.ajax({
                type: "POST",
                url: url,
                data: form.serialize(),
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                    $('.loader-wrap').removeClass('d-none');
                },
                success: function (order_id) {
                    $('.loader-wrap').addClass('d-none');
                    window.location = '/checkout/order_confirm/' + order_id;
                }
            });
        });
    });
</script>

<div class="loader-wrap d-none">
    <div class="loader">
        <div class="holder">
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
            <span class="loader-item"></span>
        </div>
    </div>
</div>
</body>

</html>